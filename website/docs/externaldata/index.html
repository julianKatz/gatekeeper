<!doctype html>
<html class="docs-version-v3.7.x" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<link rel="search" type="application/opensearchdescription+xml" title="Gatekeeper" href="/gatekeeper/website/opensearch.xml"><title data-rh="true">External Data | Gatekeeper</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://open-policy-agent.github.io/gatekeeper/website/docs//gatekeeper/website/docs/externaldata"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_version" content="v3.7.x"><meta data-rh="true" name="docusaurus_tag" content="docs-default-v3.7.x"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="v3.7.x"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-v3.7.x"><meta data-rh="true" property="og:title" content="External Data | Gatekeeper"><meta data-rh="true" name="description" content="❗ This feature is still in alpha stage, so the final form can still change (feedback is welcome!)."><meta data-rh="true" property="og:description" content="❗ This feature is still in alpha stage, so the final form can still change (feedback is welcome!)."><link data-rh="true" rel="icon" href="/gatekeeper/website/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://open-policy-agent.github.io/gatekeeper/website/docs//gatekeeper/website/docs/externaldata"><link data-rh="true" rel="alternate" href="https://open-policy-agent.github.io/gatekeeper/website/docs//gatekeeper/website/docs/externaldata" hreflang="en"><link data-rh="true" rel="alternate" href="https://open-policy-agent.github.io/gatekeeper/website/docs//gatekeeper/website/docs/externaldata" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://PT2IX43ZFM-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/gatekeeper/website/assets/css/styles.153ce504.css">
<link rel="preload" href="/gatekeeper/website/assets/js/runtime~main.c029a367.js" as="script">
<link rel="preload" href="/gatekeeper/website/assets/js/main.78f9e95c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://open-policy-agent.github.io/gatekeeper/website/docs/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/gatekeeper/website/img/logo.svg" alt="Gatekeeper logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/gatekeeper/website/img/logo.svg" alt="Gatekeeper logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Gatekeeper</b></a><a href="https://github.com/open-policy-agent/gatekeeper-library" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Library<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/gatekeeper/website/docs/">v3.7.x</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/gatekeeper/website/docs/next/externaldata">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/gatekeeper/website/docs/externaldata">v3.7.x</a></li><li><a class="dropdown__link" href="/gatekeeper/website/docs/v3.6.x/">v3.6.x</a></li></ul></div><a href="https://github.com/open-policy-agent/gatekeeper" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_S7eR toggle_TdHA toggleDisabled_f9M3"><div class="toggleButton_rCf9" role="button" tabindex="-1"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></div><input type="checkbox" class="toggleScreenReader_g2nN" aria-label="Switch between dark and light mode (currently light mode)"></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/gatekeeper/website/docs/">Getting Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/install">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/examples">Examples</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/gatekeeper/website/docs/howto">How to use Gatekeeper</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/howto">How to use Gatekeeper</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/audit">Audit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/violations">Handling Constraint Violations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/sync">Replicating Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/exempt-namespaces">Exempting Namespaces</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/library">Policy Library</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/customize-startup">Customizing Startup Behavior</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/customize-admission">Customizing Admission Behavior</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/metrics">Metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/debug">Debugging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/emergency">Emergency Recovery</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/vendor-specific">Cloud and Vendor Specific Fixes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/failing-closed">Failing Closed</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/mutation">Mutation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/constrainttemplates">Constraint Templates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/gatekeeper/website/docs/externaldata">External Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/gator">The gator CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/workload-resources">Working with Workload Resources</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/gatekeeper/website/docs/developers">Contributing</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/developers">Developers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/help">Want to help?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/gatekeeper/website/docs/security">Security</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">How to use Gatekeeper</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/gatekeeper/website/docs/externaldata">External Data</a></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: v3.7.x</span><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>External Data</h1></header><blockquote><p>❗ This feature is still in alpha stage, so the final form can still change (feedback is welcome!).</p></blockquote><blockquote><p>🚧  Mutation is not yet supported with external data.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_mojV" id="motivation">Motivation<a class="hash-link" href="#motivation" title="Direct link to heading">​</a></h2><p>Gatekeeper provides various means to mutate and validate Kubernetes resources. However, in many of these scenarios this data is either built-in, static or user defined. With external data feature, we are enabling Gatekeeper to interface with various external data sources, such as image registries, using a provider-based model.</p><p>A similar way to connect with an external data source can be done today using OPA&#x27;s built-in <code>http.send</code> functionality. However, there are limitations to this approach.</p><ul><li>Gatekeeper does not support Rego policies for mutation, which cannot use the OPA <code>http.send</code> built-in function.</li><li>Security concerns due to:<ul><li>if template authors are not trusted, it will potentially give template authors access to the in-cluster network.</li><li>if template authors are trusted, authors will need to be careful on how rego is written to avoid injection attacks.</li></ul></li></ul><p>Key benefits provided by the external data solution:</p><ul><li>Addresses security concerns by:<ul><li>Restricting which hosts a user can access.</li><li>Providing an interface for making requests, which allows Gatekeeper to better handle things like escaping strings.</li></ul></li><li>Addresses common patterns with a single provider, e.g. image tag-to-digest mutation, which can be leveraged by multiple scenarios (e.g. validating image signatures or vulnerabilities).</li><li>Provider model creates a common interface for extending Gatekeeper with external data.<ul><li>It allows for separation of concerns between the implementation that allows access to external data and the actual policy being evaluated.</li><li>Developers and consumers of data sources can rely on that common protocol to ease authoring of both constraint templates and data sources.</li><li>Makes change management easier as users of an external data provider should be able to tell whether upgrading it will break existing constraint templates. (once external data API is stable, our goal is to have that answer always be &quot;no&quot;)</li></ul></li><li>Performance benefits as Gatekeeper can now directly control caching and which values are significant for caching, which increases the likelihood of cache hits.<ul><li>For mutation, we can batch requests via lazy evaluation.</li><li>For validation, we make batching easier via <a href="#external-data-for-Gatekeeper-validating-webhook"><code>external_data</code></a> Rego function design.</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="enabling-external-data-support">Enabling external data support<a class="hash-link" href="#enabling-external-data-support" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="yaml">YAML<a class="hash-link" href="#yaml" title="Direct link to heading">​</a></h3><p>You can enable external data support by adding <code>--enable-external-data</code> in gatekeeper audit and controller-manager deployment arguments.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="helm">Helm<a class="hash-link" href="#helm" title="Direct link to heading">​</a></h3><p>You can also enable external data by installing or upgrading Helm chart by setting <code>enableExternalData=true</code>:</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">helm install gatekeeper/gatekeeper --name-template=gatekeeper --namespace gatekeeper-system --create-namespace \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --set enableExternalData=true \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --set controllerManager.dnsPolicy=ClusterFirst,audit.dnsPolicy=ClusterFirst</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><blockquote><p>Please note that setting dnsPolicy is a workaround for a bug that is already fixed and will be available in a future release.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_mojV" id="devtest">Dev/Test<a class="hash-link" href="#devtest" title="Direct link to heading">​</a></h3><p>For dev/test deployments, use <code>make deploy ENABLE_EXTERNAL_DATA=true</code></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="providers">Providers<a class="hash-link" href="#providers" title="Direct link to heading">​</a></h2><p>Providers are designed to be in-cluster components that can communicate with external data sources (such as image registries, Active Directory/LDAP directories, etc) and return data in a format that can be processed by Gatekeeper.</p><p>Example provider can be found at: <a href="https://github.com/open-policy-agent/gatekeeper/tree/master/test/externaldata/dummy-provider" target="_blank" rel="noopener noreferrer">https://github.com/open-policy-agent/gatekeeper/tree/master/test/externaldata/dummy-provider</a></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="provider-implementation">Provider implementation<a class="hash-link" href="#provider-implementation" title="Direct link to heading">​</a></h2><p>Provider is an HTTP server that listens on a port and responds to <a href="#ProviderRequest">ProviderRequest</a> with <a href="#ProviderResponse">ProviderResponse</a>.</p><p>As part of <a href="#ProviderResponse">ProviderResponse</a>, the provider can return a list of items. Each item is a JSON object with the following fields:</p><ul><li><code>Key</code>: the key that was sent to the provider</li><li><code>Value</code>: the value that was returned from the provider for that key</li><li><code>Error</code>: an error message if the provider returned an error for that key</li></ul><p>If there is a system error, the provider should return the system error message in the <code>SystemError</code> field.</p><blockquote><p>📎 Recommendation is for provider implementations to keep a timeout such as maximum of 1-2 seconds for the provider to respond.</p></blockquote><p>Example provider implementation: <a href="https://github.com/open-policy-agent/gatekeeper/blob/master/test/externaldata/dummy-provider/provider.go" target="_blank" rel="noopener noreferrer">https://github.com/open-policy-agent/gatekeeper/blob/master/test/externaldata/dummy-provider/provider.go</a></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="gatekeeper-provider-custom-resource">Gatekeeper Provider custom resource<a class="hash-link" href="#gatekeeper-provider-custom-resource" title="Direct link to heading">​</a></h2><p>Provider resource defines the provider and the configuration for it.</p><div class="codeBlockContainer_I0IT language-yaml theme-code-block"><div class="codeBlockContent_wNvx yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> externaldata.gatekeeper.sh/v1alpha1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Provider</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">provider</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//&lt;service</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">.&lt;namespace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">&lt;port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">/&lt;endpoint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># URL to the external data source (e.g., http://my-provider.my-namespace:8090/validate)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">timeout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &lt;timeout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># timeout value in seconds (e.g., 1). this is the timeout on the Provider custom resource, not the provider implementation.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="external-data-for-gatekeeper-validating-webhook">External data for Gatekeeper validating webhook<a class="hash-link" href="#external-data-for-gatekeeper-validating-webhook" title="Direct link to heading">​</a></h2><p>External data adds a <a href="https://www.openpolicyagent.org/docs/latest/extensions/#custom-built-in-functions-in-go" target="_blank" rel="noopener noreferrer">custom OPA built-in function</a> called <code>external_data</code> to Rego. This function is used to query external data providers.</p><p><code>external_data</code> is a function that takes a request and returns a response. The request is a JSON object with the following fields:</p><ul><li><code>Provider</code>: the name of the provider to query</li><li><code>Keys</code>: the list of keys to send to the provider</li></ul><p>e.g.,</p><div class="codeBlockContainer_I0IT language-rego theme-code-block"><div class="codeBlockContent_wNvx rego"><pre tabindex="0" class="prism-code language-rego codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # build a list of keys containing images for batching</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  my_list := [img | img = input.review.object.spec.template.spec.containers[_].image]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # send external data request</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  response := external_data({&quot;provider&quot;: &quot;my-provider&quot;, &quot;keys&quot;: my_list})</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Response example: [<!-- -->[<code>&quot;my-key&quot;</code>, <code>&quot;my-value&quot;</code>, <code>&quot;&quot;</code>]<!-- -->, <!-- -->[<code>&quot;another-key&quot;</code>, <code>42</code>, <code>&quot;&quot;</code>]<!-- -->, <!-- -->[<code>&quot;bad-key&quot;</code>, <code>&quot;&quot;</code>, <code>&quot;error message&quot;</code>]<!-- -->]</p><blockquote><p>📎 To avoid multiple calls to the same provider, recommendation is to batch the keys list to send a single request.</p></blockquote><p>Example template:
<a href="https://github.com/open-policy-agent/gatekeeper/blob/master/test/externaldata/dummy-provider/policy/template.yaml" target="_blank" rel="noopener noreferrer">https://github.com/open-policy-agent/gatekeeper/blob/master/test/externaldata/dummy-provider/policy/template.yaml</a></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="api">API<a class="hash-link" href="#api" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="version-v1alpha1">Version v1alpha1<a class="hash-link" href="#version-v1alpha1" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="providerrequest">ProviderRequest<a class="hash-link" href="#providerrequest" title="Direct link to heading">​</a></h4><p>Request is the API request that is sent to the external data provider.</p><div class="codeBlockContainer_I0IT language-go theme-code-block"><div class="codeBlockContent_wNvx go"><pre tabindex="0" class="prism-code language-go codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ProviderRequest is the API request for the external data provider.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> ProviderRequest </span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// APIVersion is the API version of the external data provider.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    APIVersion </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;apiVersion,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Kind is kind of the external data provider API call. This can be &quot;ProviderRequest&quot; or &quot;ProviderResponse&quot;.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Kind ProviderKind </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;kind,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Request contains the request for the external data provider.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Request Request </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;request,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Request is the struct that contains the keys to query.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> Request </span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Keys is the list of keys to send to the external data provider.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Keys </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;keys,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="providerresponse">ProviderResponse<a class="hash-link" href="#providerresponse" title="Direct link to heading">​</a></h4><p>Response is the API response that a provider must return.</p><div class="codeBlockContainer_I0IT language-go theme-code-block"><div class="codeBlockContent_wNvx go"><pre tabindex="0" class="prism-code language-go codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// ProviderResponse is the API response from a provider.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> ProviderResponse </span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// APIVersion is the API version of the external data provider.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    APIVersion </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;apiVersion,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Kind is kind of the external data provider API call. This can be &quot;ProviderRequest&quot; or &quot;ProviderResponse&quot;.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Kind ProviderKind </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;kind,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Response contains the response from the provider.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Response Response </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;response,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Response is the struct that holds the response from a provider.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> Response </span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Idempotent indicates that the responses from the provider are idempotent.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Applies to mutation only and must be true for mutation.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Idempotent </span><span class="token builtin" style="color:rgb(130, 170, 255)">bool</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;idempotent,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Items contains the key, value and error from the provider.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Items </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">Item </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;items,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// SystemError is the system error of the response.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    SystemError </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;systemError,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Items is the struct that contains the key, value or error from a provider response.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> Item </span><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Key is the request from the provider.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Key </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;key,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Value is the response from the provider.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Value </span><span class="token keyword" style="font-style:italic">interface</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;value,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Error is the error from the provider.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Error </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">`json:&quot;error,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/open-policy-agent/gatekeeper/edit/master/website/versioned_docs/version-v3.7.x/externaldata.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/gatekeeper/website/docs/constrainttemplates"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Constraint Templates</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/gatekeeper/website/docs/gator"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">The gator CLI</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#motivation" class="table-of-contents__link toc-highlight">Motivation</a></li><li><a href="#enabling-external-data-support" class="table-of-contents__link toc-highlight">Enabling external data support</a><ul><li><a href="#yaml" class="table-of-contents__link toc-highlight">YAML</a></li><li><a href="#helm" class="table-of-contents__link toc-highlight">Helm</a></li><li><a href="#devtest" class="table-of-contents__link toc-highlight">Dev/Test</a></li></ul></li><li><a href="#providers" class="table-of-contents__link toc-highlight">Providers</a></li><li><a href="#provider-implementation" class="table-of-contents__link toc-highlight">Provider implementation</a></li><li><a href="#gatekeeper-provider-custom-resource" class="table-of-contents__link toc-highlight">Gatekeeper Provider custom resource</a></li><li><a href="#external-data-for-gatekeeper-validating-webhook" class="table-of-contents__link toc-highlight">External data for Gatekeeper validating webhook</a></li><li><a href="#api" class="table-of-contents__link toc-highlight">API</a><ul><li><a href="#version-v1alpha1" class="table-of-contents__link toc-highlight">Version v1alpha1</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/open-policy-agent/gatekeeper" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://openpolicyagent.slack.com/messages/CDTN970AX" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://docs.google.com/document/d/1A1-Q-1OMw3QODs1wT6eqfLTagcGmgzAJAjJihiO3T48/edit)" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Meetings<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/gatekeeper/website/assets/js/runtime~main.c029a367.js"></script>
<script src="/gatekeeper/website/assets/js/main.78f9e95c.js"></script>
</body>
</html>